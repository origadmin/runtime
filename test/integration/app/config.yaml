# This YAML file directly instantiates the structure defined in app/proto/bootstrap.proto.

# A list of available service discovery configurations.
discoveries:
  consul-prod:
    name: "consul-prod"
    type: "consul"
    consul:
      address: "consul.prod.svc.cluster.local:8500"
      scheme: "http"
  etcd-legacy:
    name: "etcd-legacy"
    type: "etcd"
    etcd:
      endpoints:
        - "etcd1.legacy:2379"
        - "etcd2.legacy:2379"

# The name of the discovery to use for self-registration.
registration_discovery_name: "consul-prod"

# A unified list of server endpoints this application will expose.
# This structure is defined inside bootstrap.proto.
servers:
  - name: "public-http"
    protocol: "http"
    http:
      addr: ":8000"
      timeout: "1s"
      network: "tcp"
  - name: "internal-grpc"
    protocol: "grpc"
    grpc:
      addr: ":9000"
      timeout: "1s"
      network: "tcp"

# Clients configuration, following the Broker Pattern.
clients:
  default: "user-service-client"
  active: "user-service-client"
  clients:
    - name: "user-service-client"
      protocol: "grpc"
      grpc:
        endpoint: "discovery:///user-service"
        timeout: "1s"
        middlewares:
          - "tracing"
          - "retry"
        discovery_name: "consul-prod"
    - name: "order-service-client"
      protocol: "http"
      http:
        endpoint: "discovery:///order-service"
        timeout: "1s"
        middlewares:
          - "circuit_breaker"
          - "logging"
        discovery_name: "etcd-legacy"

# Global middleware chain configuration.
middlewares:
  middlewares:
    - name: "global-logging"
      type: "logging"
      enabled: true
    - name: "global-recovery"
      type: "recovery"
      enabled: true
