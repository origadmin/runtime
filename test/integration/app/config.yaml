# This YAML file directly instantiates the structure defined in app/proto/bootstrap.proto.

# A list of available service discovery configurations.
discoveries:
  consul-prod:
    name: "consul-prod"
    type: "consul"
    consul:
      address: "consul.prod.svc.cluster.local:8500"
      scheme: "http"
  etcd-legacy:
    name: "etcd-legacy"
    type: "etcd"
    etcd:
      endpoints:
        - "etcd1.legacy:2379"
        - "etcd2.legacy:2379"

# The name of the discovery to use for self-registration.
registration_discovery_name: "consul-prod"

# A unified list of server endpoints this application will expose.
# This structure is defined inside bootstrap.proto.
servers:
  - name: "public-http"
    http:
      network: "tcp"
      addr: ":8000"
      timeout: "1s"
  - name: "internal-grpc"
    grpc:
      network: "tcp"
      addr: ":9000"
      timeout: "1s"

# A list of downstream clients, each with its own specific middleware.
# This structure is also defined inside bootstrap.proto.
clients:
  - client_name: "user-service-client"
    discoveries:
      - name: "user-service"
        discovery_name: "consul-prod"
    middlewares:
      - name: "tracing"
      - name: "retry"
        options:
          attempts: 3
          backoff: "0.1s"
  - client_name: "order-service-client"
    discoveries:
      - name: "order-service"
        discovery_name: "etcd-legacy"
    middlewares:
      - name: "circuit_breaker"
      - name: "logging"