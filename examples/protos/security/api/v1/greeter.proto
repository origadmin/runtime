syntax = "proto3";

package runtime.examples.security.api.v1;

import "google/api/annotations.proto";
import "security/v1/security.proto";

option go_package = "github.com/origadmin/runtime/examples/security/api/v1;v1";

// The greeter service definition.
service Greeter {
  // 1. Public Access: No security checks required.
  // Using a leading dot to specify an absolute path for the option.
  rpc SayHelloPublic(HelloRequest) returns (HelloReply) {
    option (google.api.http) = {get: "/v1/greeter/public/{name}"};
    option (runtime.api.security.v1.policy) = {name: "public"};
  }

  // 2. Authenticated Access: Requires a valid identity (Authn).
  rpc SayHelloAuthenticated(HelloRequest) returns (HelloReply) {
    option (google.api.http) = {get: "/v1/greeter/authenticated/{name}"};
    option (runtime.api.security.v1.policy) = {name: "authn-only"};
  }

  // 3. Authorized Access: Requires a valid identity with specific roles (Authn + Authz).
  rpc SayHelloAuthorized(HelloRequest) returns (HelloReply) {
    option (google.api.http) = {get: "/v1/greeter/authorized/{name}"};
    option (runtime.api.security.v1.policy) = {name: "authn-authz"};
  }
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}
