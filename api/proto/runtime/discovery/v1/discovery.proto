syntax = "proto3";

package runtime.discovery.v1;

import "google/protobuf/struct.proto";
import "validate/validate.proto";

option cc_enable_arenas = true;
option go_package = "github.com/origadmin/runtime/api/gen/go/runtime/discovery/v1;discoveryv1";
option java_multiple_files = true;
option java_outer_classname = "DiscoveryProto";
option java_package = "com.github.origadmin.api.runtime.discovery.v1";
option objc_class_prefix = "ORD";

// Discovery defines the configuration for service registration.
message Discovery {
  // name is the the service key in the registry.
  string name = 1 [json_name = "name"];

  // type specifies which discovery provider to use.
  string type = 2 [
    json_name = "type",
    (validate.rules).string = {
      in: [
        "none",
        "consul",
        "etcd",
        "nacos",
        "apollo",
        "kubernetes",
        "polaris",
        "customize"
      ]
    }
  ];

  // debug enables verbose logging for the discovery client.
  bool debug = 5 [json_name = "debug"];

  // --- Standard Provider Configurations ---
  optional Consul consul = 10 [json_name = "consul"];
  optional ETCD etcd = 11 [json_name = "etcd"];
  optional Nacos nacos = 12 [json_name = "nacos"];
  optional Apollo apollo = 13 [json_name = "apollo"];
  optional Kubernetes kubernetes = 14 [json_name = "kubernetes"];
  optional Polaris polaris = 15 [json_name = "polaris"];
  optional google.protobuf.Struct customize = 100 [json_name = "customize"];
}

message Discoveries {
  // default is the name of the discovery service to use by default.
  optional string default = 1 [json_name = "default"];

  // active specifies the name of the discovery service to use, overriding the default.
  optional string active = 2 [json_name = "active"];

  repeated Discovery discoveries = 3 [json_name = "discoveries"];


}

// --- Message Definitions for Each Provider ---

// Consul provider specific configuration.
message Consul {
  string address = 1;
  string scheme = 2;
  string token = 3;
  bool heart_beat = 4;
  bool health_check = 5;
  string datacenter = 6;
  uint32 health_check_interval = 8;
  int64 timeout = 10;
  uint32 deregister_critical_service_after = 11;
}

// ETCD provider specific configuration.
message ETCD {
  repeated string endpoints = 1;
}

// Nacos provider specific configuration (placeholder).
message Nacos {
  // e.g., string server_addr = 1;
  // e.g., string namespace_id = 2;
}

// Apollo provider specific configuration (placeholder).
message Apollo {
  // e.g., string meta_server_addr = 1;
  // e.g., string app_id = 2;
}

// Kubernetes provider specific configuration (placeholder).
message Kubernetes {
  // e.g., string kube_config_path = 1;
}

// Polaris provider specific configuration (placeholder).
message Polaris {
  string address = 1;
  string scheme = 2;
  string token = 3;
}
