syntax = "proto3";

package runtime.transport.v1;

import "google/protobuf/struct.proto";
// 导入新的、模块化的协议定义
import "runtime/transport/grpc/v1/grpc.proto";
import "runtime/transport/http/v1/http.proto";

option go_package = "github.com/origadmin/runtime/api/gen/go/runtime/transport/v1;transportv1";

// =================================================================
//  Server Definitions
// =================================================================

// Server is a generic container for a single server-side transport configuration.
// It uses optional fields to represent different protocol types, avoiding the use of `oneof`.
message Server {
  // name is the logical name for this server configuration.
  // It is used to identify this server in the application's configuration.
  string name = 1 [json_name = "name"];

  // The following fields are transport-specific configurations.
  // Only one of these should be set for a given Server instance.

  // gRPC server configuration.
  optional runtime.transport.grpc.v1.Server grpc = 2 [json_name = "grpc"];

  // HTTP server configuration.
  optional runtime.transport.http.v1.Server http = 3 [json_name = "http"];

  // customize is used for non-standard or user-defined transport protocols.
  // It allows for flexible configuration without modifying this core proto file.
  optional google.protobuf.Struct customize = 100 [json_name = "customize"];
}

// =================================================================
//  Client Definitions
// =================================================================

// Clients defines a collection of client configurations for services that this service depends on.
// This structure follows the "Broker Pattern" to avoid using maps, providing a clear
// and explicit way to manage multiple named client instances.
message Clients {
  // default is the name of the default client configuration to use from the `clients` list.
  string default = 1 [json_name = "default"];

  // clients is a list of all available client configurations.
  repeated Client clients = 2 [json_name = "clients"];
}

// Client is a generic container for a single client-side transport configuration.
message Client {
  // name is the logical name for this client configuration.
  // It is used to uniquely identify this client dependency in the application.
  string name = 1 [json_name = "name"];

  // The following fields are transport-specific configurations.
  // Only one of these should be set for a given Client instance.

  // gRPC client configuration.
  optional runtime.transport.grpc.v1.Client grpc = 2 [json_name = "grpc"];

  // HTTP client configuration.
  optional runtime.transport.http.v1.Client http = 3 [json_name = "http"];

  // customize is used for non-standard or user-defined transport protocols.
  optional google.protobuf.Struct customize = 100 [json_name = "customize"];
}
