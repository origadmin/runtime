syntax = "proto3";

package runtime.data.storage.v1;

import "gnostic/openapi/v3/annotations.proto";
import "runtime/data/storage/v1/file_local.proto"; // Import FileLocalConfig
import "runtime/data/storage/v1/oss.proto"; // Import OssConfig
import "validate/validate.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/origadmin/runtime/api/gen/go/runtime/data/storage/v1;storagev1";

// FileStoreConfig groups all "file/object storage" type backends into one category.
// It uses the 'driver' field to determine which specific implementation to use.
// This message was extracted from storage.proto and renamed for consistency.
message FileStoreConfig {
  string name = 1 [
    json_name = "name",
    (gnostic.openapi.v3.property) = {description: "file store name"}
  ];

  // The 'driver' field determines which configuration block (local or oss) to use.
  // This field is crucial for ensuring JSON/YAML compatibility.
  string driver = 2 [
    json_name = "driver",
    (validate.rules).string = {
      in: [
        "local",
        "oss",
        "customize"
      ]
    },
    (gnostic.openapi.v3.property) = {description: "file store driver name"}
  ];

  // Local file system configuration. Only effective when driver is "local".
  // The optional keyword clearly indicates that this field may not be present.
  optional FileLocalConfig local = 3 [
    json_name = "local",
    (gnostic.openapi.v3.property) = {description: "local file system configuration"}
  ]; // Updated to FileLocalConfig

  // Cloud object storage configuration. Only effective when driver is "oss".
  optional OssConfig oss = 4 [
    json_name = "oss",
    (gnostic.openapi.v3.property) = {description: "cloud object storage configuration"}
  ]; // Updated to OssConfig

  // Chunk size in bytes for splitting large files.
  // For OSS, this corresponds to the multipart upload part size.
  // For local storage, it defines the size of individual blob files.
  // If 0 or not set, a reasonable default (e.g., 4MB) will be used by the implementation.
  int64 chunk_size = 5 [
    json_name = "chunk_size",
    (gnostic.openapi.v3.property) = {description: "chunk size in bytes"}
  ];

  // Optional custom configuration for file store types not explicitly defined.
  optional google.protobuf.Struct customize = 6 [
    json_name = "customize",
    (gnostic.openapi.v3.property) = {description: "Custom configuration for file store types not explicitly defined."}
  ];
}
