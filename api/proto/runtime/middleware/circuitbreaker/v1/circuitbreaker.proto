syntax = "proto3";

package runtime.middleware.circuitbreaker.v1;

import "runtime/config/v1/gateway.proto";

option cc_enable_arenas = true;
option go_package = "github.com/origadmin/runtime/api/gen/go/runtime/middleware/circuitbreaker/v1;circuitbreakerv1";
option java_multiple_files = true;
option java_outer_classname = "CircuitBreakerProto";
option java_package = "com.github.origadmin.api.runtime.middleware.circuitbreaker.v1";
option objc_class_prefix = "OMC";
option php_namespace = "OrigAdmin\\Runtime\\Middleware\\CircuitBreaker\\V1";

message Header {
  string key = 1;
  repeated string value = 2;
}

message ResponseData {
  int32 status_code = 1;
  repeated Header header = 2;
  bytes body = 3;
}

message BackupService {
  runtime.config.v1.Endpoint endpoint = 1 [json_name = "endpoint"];
}

message SuccessRatio {
  double success = 1;
  int32 request = 2;
  int32 bucket = 3;
  int64 window = 4;
}

// CircuitBreaker middleware config.
message CircuitBreaker {
  // Only one of success_ratio or ratio should be set.
  optional SuccessRatio success_ratio = 1 [json_name = "success_ratio"];
  optional int64 ratio = 2 [json_name = "ratio"];

  // Only one of response_data or backup_service should be set.
  optional ResponseData response_data = 3 [json_name = "response_data"];
  optional BackupService backup_service = 4 [json_name = "backup_service"];

  repeated runtime.config.v1.Condition assert_condtions = 5 [json_name = "assert_condtions"];
}
