syntax = "proto3";

package middleware.v1;

import "extension/v1/extension.proto";
import "middleware/v1/circuitbreaker/circuitbreaker.proto";
import "middleware/v1/cors/cors.proto";
import "middleware/v1/jwt/jwt.proto";
import "middleware/v1/metrics/metrics.proto";
import "middleware/v1/ratelimit/ratelimiter.proto";
import "middleware/v1/selector/selector.proto";
import "middleware/v1/validator/validator.proto";

option cc_enable_arenas = true;
option go_package = "github.com/origadmin/runtime/api/gen/go/middleware/v1;middlewarev1";
option java_multiple_files = true;
option java_outer_classname = "MiddlewareProto";
option java_package = "com.github.origadmin.api.runtime.middleware.v1";
option objc_class_prefix = "OMX";
option php_namespace = "OrigAdmin\\Runtime\\Middleware\\V1";

// MiddlewareConfig represents a single middleware configuration with an enable switch.
message MiddlewareConfig {
  bool enabled = 1 [json_name = "enabled"];

  oneof middleware {
    middleware.v1.ratelimit.RateLimiter rate_limiter = 2;
    middleware.v1.metrics.Metrics metrics = 3;
    middleware.v1.validator.Validator validator = 4;
    middleware.v1.jwt.JWT jwt = 5;
    middleware.v1.selector.Selector selector = 6;
    middleware.v1.cors.Cors cors = 7;
    middleware.v1.circuitbreaker.CircuitBreaker circuit_breaker = 8;
    extension.v1.Extension.Config custom = 100; // Using Extension.Config for custom middlewares, moved to last
    // Add other specific middleware types here as they are defined
  }
}

// Middlewares is used to configure a chain of middlewares for an entry point.
message Middlewares {
  // A list of middleware configurations to be applied in order.
  repeated MiddlewareConfig middlewares = 1 [json_name = "middlewares"];
}
