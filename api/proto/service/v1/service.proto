syntax = "proto3";

package service.v1;

import "transport/v1/grpc.proto";
import "transport/v1/http.proto";
import "msg/v1/msg.proto";
import "task/v1/task.proto";
import "websocket/v1/websocket.proto";
import "middleware/v1/middleware.proto";
import "validate/validate.proto";

option cc_enable_arenas = true;
option go_package = "github.com/origadmin/runtime/api/gen/go/service/v1;servicev1";
option java_multiple_files = true;
option java_outer_classname = "ServiceProto";
option java_package = "com.github.origadmin.api.runtime.service.v1";
option objc_class_prefix = "ORC";

message Service {
  // Selector
  message Selector {
    string version = 1 [json_name = "version"];
    string global_builder = 2 [json_name = "global_builder"];
  }
  // Service name for service discovery
  string name = 1 [json_name = "name"];

  // Protocol defines the communication protocol for the service
  string protocol = 2 [
    json_name = "protocol",
    (validate.rules).string = {
      in: [
        "http",
        "grpc",
        "websocket",
        "message",
        "task"
      ]
    }
  ];

  // Protocol-specific configurations.
  // Only the configuration matching the 'protocol' field will be used.
  transport.v1.GRPC grpc = 10 [json_name = "grpc"];
  transport.v1.HTTP http = 20 [json_name = "http"];

  websocket.v1.WebSocket websocket = 100 [json_name = "websocket"];
  msg.v1.Message message = 200 [json_name = "message"];
  task.v1.Task task = 300 [json_name = "task"];

  // Middleware configuration for the service.
  repeated middleware.v1.MiddlewareConfig middlewares = 400 [json_name = "middlewares"];

  Selector selector = 500 [json_name = "selector"];
}
