syntax = "proto3";

package runtime.api.config.security.v1;

import "config/security/authn/apikey/v1/credential.proto";
import "config/security/authn/basic/v1/credential.proto";
import "config/security/authn/oidc/v1/credential.proto";
import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/any.proto";
import "validate/validate.proto";

option go_package = "github.com/origadmin/runtime/api/gen/go/config/security/v1;securityv1";

// Credential is a generic container for transmitting credential data between services.
// It carries the raw credential string and optionally a parsed, structured payload.
message Credential {
  // Type indicates the kind of credential, e.g., "jwt", "apikey", "basic".
  // This helps the receiving service understand how to interpret the raw data or payload.
  string type = 1 [
    json_name = "type",
    (gnostic.openapi.v3.property) = {description: "Type of the credential (e.g., 'jwt', 'apikey')."}
  ];

  // Raw contains the original, unparsed credential string.
  // For example, the full "Bearer eyJ..." JWT string, or the API key string.
  string raw = 2 [
    json_name = "raw",
    (gnostic.openapi.v3.property) = {description: "Original, unparsed credential string."}
  ];

  // ParsedPayload optionally contains a structured representation of the credential.
  // This can be used if the sending service (e.g., Gateway) has already
  // performed some parsing and wants to avoid re-parsing on the receiving end.
  // The type of the message inside Any should correspond to the 'type' field.
  google.protobuf.Any parsed_payload = 3 [
    json_name = "parsed_payload",
    (gnostic.openapi.v3.property) = {description: "Optional structured payload of the credential."}
  ];

  // The specific credential payload.
  oneof payload {
    // Payload for HTTP Basic authentication.
    runtime.api.config.security.authn.basic.v1.BasicCredential basic = 4;

    // Payload for API Key or Preshared Key authentication.
    runtime.api.config.security.authn.apikey.v1.KeyCredential key = 5;

    // Payload for OIDC authentication.
    runtime.api.config.security.authn.oidc.v1.OidcCredential oidc = 6;

    // Payload for standard token-based flows like JWT and OAuth2.
    TokenCredential token = 7;
  }
}

// TokenCredential holds the credentials for token-based authentication flows
// like OAuth2 and JWT. It is a shared structure representing the typical
// payload returned from a token endpoint.
message TokenCredential {
  // The access token used for authentication.
  string access_token = 1 [
    json_name = "access_token",
    (validate.rules).string.min_len = 1,
    (gnostic.openapi.v3.property) = {description: "The access token used for authentication."}
  ];

  // The refresh token used to obtain a new access token.
  string refresh_token = 2 [
    json_name = "refresh_token",
    (gnostic.openapi.v3.property) = {description: "The refresh token used to obtain a new access token."}
  ];

  // The remaining lifetime of the access token in seconds.
  int64 expires_in = 3 [
    json_name = "expires_in",
    (gnostic.openapi.v3.property) = {description: "The remaining lifetime of the access token in seconds."}
  ];

  // The type of the token, typically "Bearer".
  string token_type = 4 [
    json_name = "token_type",
    (gnostic.openapi.v3.property) = {description: "The type of the token, typically 'Bearer'."}
  ];
}
