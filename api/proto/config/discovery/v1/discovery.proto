syntax = "proto3";

package runtime.api.config.discovery.v1;

import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/struct.proto";
import "validate/validate.proto";

option go_package = "github.com/origadmin/runtime/api/gen/go/config/discovery/v1;discoveryv1";





// Discovery defines the configuration for service registration.
message Discovery {
  // name is the the service key in the registry.
  string name = 1 [
    json_name = "name",
    (gnostic.openapi.v3.property) = {description: "The name of the discovery service configuration."}
  ];

  // The 'type' field determines which discovery provider to use.
  // For built-in types, specify "consul", "etcd", "nacos", etc.
  // For custom types, specify the registered name of the custom discovery provider.
  // When a custom type is used, its configuration should be placed in the 'customize' field.
  string type = 2 [
    json_name = "type",
    (gnostic.openapi.v3.property) = {description: "The type of discovery provider to use. Built-in: 'consul', 'etcd', 'nacos', etc. Custom types use their registered name."}
  ];

  // debug enables verbose logging for the discovery client.
  bool debug = 5 [
    json_name = "debug",
    (gnostic.openapi.v3.property) = {description: "Enables verbose logging for the discovery client."}
  ];

  // --- Standard Provider Configurations ---
  optional Consul consul = 10 [
    json_name = "consul",
    (gnostic.openapi.v3.property) = {description: "Consul provider specific configuration."}
  ];
  optional ETCD etcd = 11 [
    json_name = "etcd",
    (gnostic.openapi.v3.property) = {description: "ETCD provider specific configuration."}
  ];
  optional Nacos nacos = 12 [
    json_name = "nacos",
    (gnostic.openapi.v3.property) = {description: "Nacos provider specific configuration."}
  ];
  optional Apollo apollo = 13 [
    json_name = "apollo",
    (gnostic.openapi.v3.property) = {description: "Apollo provider specific configuration."}
  ];
  optional Kubernetes kubernetes = 14 [
    json_name = "kubernetes",
    (gnostic.openapi.v3.property) = {description: "Kubernetes provider specific configuration."}
  ];
  optional Polaris polaris = 15 [
    json_name = "polaris",
    (gnostic.openapi.v3.property) = {description: "Polaris provider specific configuration."}
  ];
  optional google.protobuf.Struct customize = 100 [
    json_name = "customize",
    (gnostic.openapi.v3.property) = {description: "Custom discovery provider configuration."}
  ];
}

message Discoveries {
  // default is the name of the discovery service to use by default.
  optional string default = 1 [
    json_name = "default",
    (gnostic.openapi.v3.property) = {description: "The name of the discovery service to use by default."}
  ];

  // active specifies the name of the discovery service to use, overriding the default.
  optional string active = 2 [
    json_name = "active",
    (gnostic.openapi.v3.property) = {description: "The name of the discovery service to use, overriding the default."}
  ];

  repeated Discovery configs = 3 [
    json_name = "configs",
    (gnostic.openapi.v3.property) = {description: "A list of discovery service configurations."}
  ];
}

// --- Message Definitions for Each Provider ---

// Consul provider specific configuration.
message Consul {
  string address = 1 [
    json_name = "address",
    (gnostic.openapi.v3.property) = {description: "The address of the Consul agent."}
  ];
  string scheme = 2 [
    json_name = "scheme",
    (gnostic.openapi.v3.property) = {description: "The scheme to use for connecting to Consul (e.g., http, https)."}
  ];
  string token = 3 [
    json_name = "token",
    (gnostic.openapi.v3.property) = {description: "The ACL token for Consul authentication."}
  ];
  bool heart_beat = 4 [
    json_name = "heart_beat",
    (gnostic.openapi.v3.property) = {description: "Whether to enable heartbeating for service health checks."}
  ];
  bool health_check = 5 [
    json_name = "health_check",
    (gnostic.openapi.v3.property) = {description: "Whether to enable health checks for registered services."}
  ];
  string datacenter = 6 [
    json_name = "datacenter",
    (gnostic.openapi.v3.property) = {description: "The datacenter to use for Consul operations."}
  ];
  uint32 health_check_interval = 8 [
    json_name = "health_check_interval",
    (gnostic.openapi.v3.property) = {description: "The interval (in seconds) for health checks."}
  ];
  int64 timeout = 10 [
    json_name = "timeout",
    (gnostic.openapi.v3.property) = {description: "The timeout (in milliseconds) for Consul operations."}
  ];
  uint32 deregister_critical_service_after = 11 [
    json_name = "deregister_critical_service_after",
    (gnostic.openapi.v3.property) = {description: "The time (in seconds) after which a critical service will be deregistered."}
  ];
}

// ETCD provider specific configuration.
message ETCD {
  repeated string endpoints = 1 [
    (gnostic.openapi.v3.property) = {description: "List of ETCD server endpoints."}
  ];
}

// Nacos provider specific configuration (placeholder).
message Nacos {
  // e.g., string server_addr = 1;
  // e.g., string namespace_id = 2;
}

// Apollo provider specific configuration (placeholder).
message Apollo {
  // e.g., string meta_server_addr = 1;
  // e.g., string app_id = 2;
}

// Kubernetes provider specific configuration (placeholder).
message Kubernetes {
  // e.g., string kube_config_path = 1;
}

// Polaris provider specific configuration (placeholder).
message Polaris {
  string address = 1 [
    (gnostic.openapi.v3.property) = {description: "The address of the Polaris server."}
  ];
  string scheme = 2 [
    (gnostic.openapi.v3.property) = {description: "The scheme to use for connecting to Polaris (e.g., http, https)."}
  ];
  string token = 3 [
    (gnostic.openapi.v3.property) = {description: "The token for Polaris authentication."}
  ];
}
