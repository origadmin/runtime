syntax = "proto3";

package runtime.api.config.middleware.jwt.v1;

import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/struct.proto";
import "validate/validate.proto";

option go_package = "github.com/origadmin/runtime/api/gen/go/config/middleware/jwt/v1;jwtv1";

// JSON Web Token
message JWT {
  string claim_type = 1 [
    json_name = 'claim_type',
    (gnostic.openapi.v3.property) = {description: "The type of the claim used to extract the token."}
  ];
  google.protobuf.Struct token_header = 2 [json_name = 'token_header'];
  // The configuration for creating and validating a JWT.
  AuthConfig config = 100 [
    json_name = "config",
    (gnostic.openapi.v3.property) = {description: "The configuration used to create the token."}
  ];
}

// AuthConfig contains configuration parameters for creating and validating a JWT.
message AuthConfig {
  string signing_method = 1 [
    json_name = "signing_method",
    (validate.rules).string = {
      min_len: 1
      max_len: 1024
      pattern: "^[A-Z0-9]+$"
    },
    (gnostic.openapi.v3.property) = {description: "The signing method used for the token (e.g., HS256, RS256)."}
  ];
  string signing_key = 2 [
    json_name = "signing_key",
    (validate.rules).string = {
      min_len: 1
      max_len: 1024
    },
    (gnostic.openapi.v3.property) = {description: "The signing key used for signing the token."}
  ];
  string secondary_signing_key = 3 [
    json_name = "secondary_signing_key",
    (gnostic.openapi.v3.property) = {description: "The secondary signing key used for signing the token."}
  ];
  int64 access_token_lifetime = 4 [
    json_name = "access_token_lifetime",
    (validate.rules).int64 = {
      gte: 1
      lte: 31536000
    },
    (gnostic.openapi.v3.property) = {description: "The lifetime of the access token in seconds. A common value is 7200 (2 hours)."}
  ];
  int64 refresh_token_lifetime = 5 [
    json_name = "refresh_token_lifetime",
    (validate.rules).int64 = {
      gte: 1
      lte: 31536000
    },
    (gnostic.openapi.v3.property) = {description: "The lifetime of the refresh token in seconds."}
  ];
  string issuer = 6 [
    json_name = "issuer",
    (gnostic.openapi.v3.property) = {description: "The issuer of the token."}
  ];
  repeated string audience = 7 [
    json_name = "audience",
    (validate.rules).repeated = {
      min_items: 1
      max_items: 1024
      unique: true
    },
    (gnostic.openapi.v3.property) = {description: "The audience for which the token is intended."}
  ]; // Audience
  // Optional: Defines how to extract the token from the request.
  // Defaults to "header:Authorization" with "Bearer " prefix.
  // Example: "cookie:access_token"
  optional string token_source = 8 [
    json_name = "token_source",
    (gnostic.openapi.v3.property) = {description: "Defines how to extract the token from the request. Defaults to 'header:Authorization'."}
  ];
}
